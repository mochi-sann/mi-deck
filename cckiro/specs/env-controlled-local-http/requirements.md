# 環境変数制御によるローカルHTTP接続要件

## 概要
ローカルのMisskeyサーバー（localhost、127.0.0.1、::1）に対するHTTP接続を環境変数で制御できるようにする。

## 機能要件

### FR-1: 環境変数による制御
- 環境変数 `VITE_ENABLE_LOCAL_HTTP` が `true` に設定されている場合のみ、ローカルアドレスに対してHTTPプロトコルを使用する
- 環境変数が設定されていない、または `true` 以外の値の場合は、ローカルアドレスに対してもHTTPSプロトコルを使用する

### FR-2: 対象ローカルアドレス
以下のアドレスを「ローカルアドレス」として扱う：
- `localhost`
- `127.0.0.1`
- `::1`（IPv6ローカルホスト）
- `[::1]`（IPv6ブラケット記法）

### FR-3: リモートアドレスの動作
- リモートアドレス（ローカルアドレス以外）に対しては常にHTTPSプロトコルを使用する
- この動作は環境変数の影響を受けない

### FR-4: 環境変数値の検証
- 環境変数の値は文字列として `"true"` の場合のみ有効とする
- 大文字小文字を区別する（`"TRUE"` や `"True"` は無効）

## 非機能要件

### NFR-1: 後方互換性
- 既存のコードで環境変数が設定されていない場合でも正常に動作する
- デフォルトの動作はHTTPS接続とする

### NFR-2: テスト要件
- 環境変数が設定されている場合とされていない場合の両方をテストする
- 無効な環境変数値に対するテストも含める

### NFR-3: パフォーマンス
- 環境変数の読み取りは初回のみ行い、キャッシュする

## 制約条件

### CON-1: 開発環境のみ
- この機能は主に開発環境での使用を想定している
- 本番環境では環境変数を設定しないことを推奨

### CON-2: セキュリティ
- HTTP接続を有効にする場合は、開発環境でのみ使用し、機密情報を扱わないこと

## 受け入れ基準

1. 環境変数 `VITE_ENABLE_LOCAL_HTTP=true` が設定されている場合、ローカルアドレスへの接続でHTTPが使用される
2. 環境変数が未設定または `true` 以外の場合、ローカルアドレスへの接続でもHTTPSが使用される
3. リモートアドレスへの接続では常にHTTPSが使用される
4. 既存のテストが全て通過する
5. 新しい環境変数制御に関するテストが追加される